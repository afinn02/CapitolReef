---
title: "Capitol Reef Photo Data Summary"
author: "IA Student Analyst Team"
date: "`r format(Sys.Date(), '%m/%d/%Y')`"
output: 
  prettydoc::html_pretty:
    theme: cayman
---
```{r, include=FALSE}
# Set CRAN mirror before installing packages
options(repos = c(CRAN = "https://cloud.r-project.org"))

# Install and load the necessary packages
if (!requireNamespace("prettydoc", quietly = TRUE)) {
  install.packages("prettydoc")
}
if (!require("kableExtra")) install.packages('kableExtra')
library(kableExtra)
library(prettydoc)
```

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r, include=FALSE}
library(readxl)
library(dplyr)
library(openxlsx)
library(RColorBrewer)
library(viridis)
library(ggplot2)
```

```{r, include=FALSE}
file_path <- "PhotoWildlifeData_UMichDataShare_12042023.xlsx"
sheet_names <- excel_sheets(file_path)
all_dataframes <- list()
for (sheet in sheet_names) {
  df <- read_excel(file_path, sheet = sheet)
  all_dataframes[[sheet]] <- df
}

photoData <- all_dataframes[['PhotoData']]
siteLocations <- all_dataframes[['SiteLocations']]
metaData <- all_dataframes[['Metadata']]

metrics <- read_excel('Metrics_CameraData_capitolReefNP.xlsx')

```
## Overview: Capitol Reef Camera Data
```{r, include=FALSE}
photoData$DateTime <- as.POSIXct(photoData$DateTime, format="%Y-%m-%d %H:%M:%S")

max_date <- max(photoData$DateTime)
min_date <- min(photoData$DateTime)

min_date <- as.Date(min_date)
max_date <- as.Date(max_date)

locations <- unique(photoData$RegionSite)
cameras <- unique(photoData$Camera)
```
The following file is a summary of the data captured from motion sensor cameras within Capitol Reef National Park. The sightings in this report occur between `r format(min_date, '%m/%d/%Y')` and `r format(max_date, '%m/%d/%Y')`. It includes a summary from `r length(locations)` location(s) and `r length(cameras)` different camera(s).


## Bighorn Sheet Monitoring:

#Percentage of Bighorn Sheep detection by gender:
The following graph demonstrates the overall detection of Bighorn Sheep throughout all recorded locations: 
`r locations` between `r format(min_date, '%m/%d/%Y')` and `r format(max_date, '%m/%d/%Y')`. Repeats are standardized by counting one detection per two-hours to account for animals that hang around the cameras.

```{r, include=FALSE}
desired_species = 'Bighorn sheep'
sheep <- photoData[(photoData$Species1 == desired_species), ]

filter_rows <- function(data) {
  data %>%
    arrange(RegionSite, DateTime) %>% 
    group_by(RegionSite) %>%           
    filter(DateTime - lag(DateTime, default = first(DateTime)) >= 7200)  # Keep rows with a time difference of at least 2 hours
}

sheep_standardize <- filter_rows(sheep)
```

```{r, echo = FALSE}

sheep_standardize$Sex_Species1 <- ifelse(sheep_standardize$Sex_Species1 %in% c('Male', 'Female'), sheep_standardize$Sex_Species1, 'Unknown/Other')

genders <- unique(sheep_standardize$Sex_Species1)


```
```{r, echo = FALSE}
coul <- brewer.pal(length(genders), "Set2")
counts <- table(sheep_standardize$Sex_Species1)
midpoints <- barplot(counts, main="Total Count of Bighorn Sheep Detection by Sex",
   xlab="Sex",
   ylab= 'Total Count',
   col=coul,
   ylim=c(0, max(counts) + 10)
   )
text(midpoints, counts, labels=counts, pos=3, cex=0.8)
```
```{r, echo=FALSE}
total_counts <- sum(counts)
percentages <- round(100 * counts / total_counts, 1)

#lables with percentages
labels <- paste(names(counts), "-", percentages, "%", sep="")

# Plot pie chart
pie(counts, labels = labels, col = brewer.pal(length(counts), "Set2"),
    main="Percentage of Total Bighorn Sheep Detection by Sex")


```
